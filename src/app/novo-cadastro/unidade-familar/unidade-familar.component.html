<div class="div-principal">
  <form [formGroup]="formgroup">
    <div class="row">
      <mat-form-field appearance="outline" class="col-3">
        <mat-label>Situação Conjugal</mat-label>
        <mat-select>
          @for (s_conjugal of s_conjugal; track s_conjugal) {
          <mat-option [value]="s_conjugal.value">{{
            s_conjugal.viewValue
          }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-3"
        ><mat-label>Data da União</mat-label>
        <input
          matInput
          [matDatepicker]="datepicker"
          formControlName="data_uniao"
        />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="datepicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #datepicker>
          <mat-datepicker-actions>
            <button matButton matDatepickerCancel>Cancel</button>
            <button matButton="elevated" matDatepickerApply>Apply</button>
          </mat-datepicker-actions>
        </mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-3"
        ><mat-label>Data da Separação</mat-label>
        <input
          matInput
          [matDatepicker]="datepicker2"
          formControlName="data_separacao"
        />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="datepicker2"
        ></mat-datepicker-toggle>
        <mat-datepicker #datepicker2>
          <mat-datepicker-actions>
            <button matButton matDatepickerCancel>Cancel</button>
            <button matButton="elevated" matDatepickerApply>Apply</button>
          </mat-datepicker-actions>
        </mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-3">
        <mat-label>Renda Familiar</mat-label>

        <input
          matInput
          type="text"
          placeholder="Informe a renda familiar"
          formControlName="renda_familiar"
        />
      </mat-form-field>
    </div>
    <div class="row">
      <div class="col-2">
        <h5>Dependente</h5>
      </div>

      <div class="col-10"></div>
    </div>

    <div class="row espaco_campos gx-0">
      <mat-form-field appearance="outline" class="col-2">
        <mat-label>Tipo de dependente</mat-label>
        <mat-select formControlName="tipo_dependente">
          @for (t_dependente of t_dependente; track t_dependente) {
          <mat-option [value]="t_dependente.value">{{
            t_dependente.viewValue
          }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-2">
        <mat-label>Nome do dependente</mat-label>

        <input
          matInput
          type="text"
          placeholder="Informe o nome"
          formControlName="nome"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-2">
        <mat-label>Data de Nascimento</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="data_nascimento"
        />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-2">
        <mat-label>Data na Familia</mat-label>
        <input
          matInput
          [matDatepicker]="picker1"
          formControlName="data_entrada_na_familia"
        />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker1"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker1></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="col-3">
        <mat-label>Informe o CPF</mat-label>

        <input
          matInput
          type="text"
          placeholder="Informe o CPF"
          formControlName="cpf_dependente"
          mask="000.000.000-00"
        />
      </mat-form-field>

      <!--btn btn-primary align-bottom-fix btn-tamanho-customizado-->

      <button
        type="button"
        class="btn btn-primary align-bottom-fix btn-tamanho-customizado2 col-1 text-center"
        (click)="adicionarDependente()"
        [disabled]="!camposDependentePreenchidos()"
      >
        <strong>+ Dependente</strong>
      </button>
    </div>
    <!--BTN ADICIONAR DEPENDENTES-->
    <div class="row campos_dependentes">
      <div class="col-6">
        <!--
          <button mat-raised-button color="primary" (click)="adicionarDependente()">
        Adicionar Dependente
         </button>
          -->
      </div>
    </div>

    <div class="row">
      <mat-form-field appearance="outline" class="col-11">
        <mat-label>Associação da Unidade Familiar</mat-label>
        <input
          matInput
          placeholder="Associação da Unidade Familiar"
          formControlName="associacao_unidade_familiar"
        />
      </mat-form-field>

      <button
        class="btn btn-primary btn-tamanho-customizado col-1"
        [disabled]="formgroup.get('associacao_unidade_familiar')?.invalid"
        (click)="adicionarUnidadeFamiliar()"
      >
        Incluir Unidade
      </button>
    </div>
    <!--
      <mat-icon
        class="flex justify-center card col-auto d-inline-flex align-items-center ajuste_plus"
        aria-hidden="false"
        aria-label="Example home icon"
        fontIcon="add"
      ></mat-icon>
      -->
  </form>
  <hr />

  <div class="table-responsive">
    <table
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z8 table table-bordered align-middle"
      *ngIf="dataSource && dataSource.length > 0"
    >
      <!-- Nome -->
      <ng-container matColumnDef="nome">
        <th mat-header-cell *matHeaderCellDef>Nome</th>
        <td mat-cell *matCellDef="let element">
          <input
            matInput
            [(ngModel)]="element.nome"
            [disabled]="!element.editando"
          />
        </td>
      </ng-container>

      <!-- CPF -->
      <ng-container matColumnDef="cpf">
        <th mat-header-cell *matHeaderCellDef>CPF</th>
        <td mat-cell *matCellDef="let element">
          <input
            matInput
            [(ngModel)]="element.cpf"
            [disabled]="!element.editando"
          />
        </td>
      </ng-container>

      <!-- Tipo Dependente -->
      <ng-container matColumnDef="tipo_dependente">
        <th mat-header-cell *matHeaderCellDef>Tipo Dependente</th>
        <td mat-cell *matCellDef="let element">
          <input
            matInput
            [(ngModel)]="element.tipo_dependente"
            [disabled]="!element.editando"
          />
        </td>
      </ng-container>

      <!-- Data Nascimento -->
      <ng-container matColumnDef="data_nascimento">
        <th mat-header-cell *matHeaderCellDef>Data Nasc.</th>
        <td mat-cell *matCellDef="let element">
          <input
            matInput
            type="date"
            [(ngModel)]="element.data_nascimento"
            [disabled]="!element.editando"
          />
        </td>
      </ng-container>

      <!-- Data Entrada na Família -->
      <ng-container matColumnDef="data_entrada_na_familia">
        <th mat-header-cell *matHeaderCellDef>Data Entrada Família</th>
        <td mat-cell *matCellDef="let element">
          <input
            matInput
            type="date"
            [(ngModel)]="element.data_entrada_na_familia"
            [disabled]="!element.editando"
          />
        </td>
      </ng-container>

      <!-- Data União -->
      <ng-container matColumnDef="data_uniao">
        <th mat-header-cell *matHeaderCellDef>Data União</th>
        <td mat-cell *matCellDef="let element">
          <input
            matInput
            type="date"
            [(ngModel)]="element.data_uniao"
            [disabled]="!element.editando"
          />
        </td>
      </ng-container>

      <!-- Ações -->
      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <!-- Faltava isso -->
        <td mat-cell *matCellDef="let element">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="editar(element)">
              <mat-icon>edit</mat-icon> Editar
            </button>
            <button
              mat-menu-item
              (click)="salvar(element)"
              [disabled]="!element.editando"
            >
              <mat-icon>save</mat-icon> Salvar
            </button>
            <button mat-menu-item (click)="remover(element)">
              <mat-icon>delete</mat-icon> Remover
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <hr />
  <table
    mat-table
    [dataSource]="dataSource"
    class="tabela"
    *ngIf="dataSource && dataSource.length > 0"
  >
    <!-- Coluna de Associação -->
    <ng-container matColumnDef="associacao">
      <th mat-header-cell *matHeaderCellDef class="tabela">Associação</th>
      <td mat-cell *matCellDef="let element" class="tabela">
        <input
          class="ajuste-campo"
          matInput
          type="text"
          [(ngModel)]="element.associacao_unidade_familiar"
          [disabled]="!element.editando"
        />
      </td>
    </ng-container>

    <!-- Coluna de Ações -->
    <ng-container matColumnDef="acoes">
      <th mat-header-cell *matHeaderCellDef class="tabela">Ações</th>
      <td mat-cell *matCellDef="let element" class="tabela ajusta-celula">
        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button
            mat-menu-item
            *ngIf="!element.editando"
            (click)="editarAssociacao(element)"
          >
            <mat-icon>edit</mat-icon>
            <span>Editar</span>
          </button>
          <button
            mat-menu-item
            *ngIf="element.editando"
            (click)="salvarAssociacao(element)"
          >
            <mat-icon>save</mat-icon>
            <span>Salvar</span>
          </button>
          <button mat-menu-item (click)="removerAssociacao(element)">
            <mat-icon>delete</mat-icon>
            <span>Excluir</span>
          </button>
        </mat-menu>
      </td>
    </ng-container>

    <!-- Cabeçalho e Linhas -->
    <tr mat-header-row *matHeaderRowDef="associacoesDisplayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: associacoesDisplayedColumns"></tr>
  </table>
</div>
